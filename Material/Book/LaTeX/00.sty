\def\options#1[#2]{\PassOptionsToPackage{#2}{#1}}

\options{bashful}[unique,dir=Excerpts]
\options{cleveref}[nameinlink]
\options{geometry}[left=2cm,right=2cm,top=2cm,bottom=2.5cm]
\options{glossaries}[toc,section=section,footnote]
\options{xcolor}[table,dvipsnames]
\options{minitoc}[tight]

\raggedbottom

\usepackage{adjustbox}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{pifont}\newcommand{\cmark}{\ding{51}}\newcommand{\xmark}{\ding{55}}%
\usepackage{amsthm}
\usepackage{bashful}
\usepackage{booktabs}
\usepackage{filecontents}
\usepackage{cf}
\usepackage{cleveref}
\usepackage{collcell}
%\usepackage{enumitem}
\usepackage{fancyhdr}
\usepackage{etoc}
\usepackage{float}
\usepackage{fontspec}
\usepackage{forest}
\usepackage{geometry}
\usepackage{glossaries}
\usepackage{glossary-long}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{mdframed}
\usepackage{minitoc}
\usepackage{morewrites}
\usepackage{multicol}
%\usepackage{multirow}
\usepackage{pbox}
\usepackage{polyglossia}
\usepackage{proof}
\usepackage{stmaryrd}
\usepackage{tabularx}
\usepackage{tcolorbox}
\usepackage{tikz}
\usepackage{url} 
%\usepackage{verbatim} 
\usepackage{xcolor}
\usepackage{yogi-code}
\usepackage{yogi-lang}
\usepackage{yogi-unicode}

% remove the stray space https://tex.stackexchange.com/a/513549
\patchcmd{\pgfutilsolvetwotwoleqfloat}
  { \noexpand\pgfmathfloatdivide@}
  {\noexpand\pgfmathfloatdivide@}
  {}{}

\floatstyle{ruled}
\restylefloat{figure}

\newtheorem{definition}{הגדרה}[section]
\newtheorem{theorem}{משפט}[section]
\newtheorem{claim}{טענה}[section]
\newtheorem{example}{דוגמה}[section]

\def\דוגמה|#1|#2\par{\begin{example}[#1]#2\end{example}}

%\numberwithin{equation}{section}
%\numberwithin{figure}{section}

\graphicspath{Images/}

\setmainlanguage{hebrew}
\setmainfont{Linux Libertine O}
\setotherlanguage{english}
\setotherlanguage{arabic}

\newfontfamily\hebrewfont[Script=Hebrew]{David CLM}
\usepackage{enumitem}
\setlist[itemize,1]{label={\fontfamily{cmr}\fontencoding{T1}\selectfont\textbullet}}



% Hebrew Font: Use precisely one option
%======================================================
%\newfontfamily\hebrewfont[Script=Hebrew]{Arial}
%\newfontfamily\hebrewfont[Script=Hebrew]{David CLM}
%\newfontfamily\hebrewfont[Script=Hebrew]{Ezra SIL}
%\newfontfamily\hebrewfont[Script=Hebrew]{Times New Roman}
%\newfontfamily\hebrewfont[Script=Hebrew]{Linux Libertine O}
%\newfontfamily\hebrewfont[Script=Hebrew]{Hadasim CLM}[
%\newfontfamily\hebrewfont[Script=Hebrew]{Hadasim CLM}[
%    BoldFont=Hadasim CLM Bold,
%    ItalicFont=Hadasim CLM RegularOblique,
%    BoldItalicFont=Hadasim CLM BoldOblique,
%    SlantedFont=Hadasim CLM RegularOblique,
%    BoldSlantedFont=Hadasim CLM BoldOblique,
%]
%\setmainfont[Script=Hebrew]{Ezra SIL}% 

\newfontfamily\arabicfont[Script=Arabic]{DejaVu Sans}
\newfontfamily\hebrewfonttt[Script=Hebrew]{Miriam Mono CLM}
\newfontfamily\hebrewfontsf[Script=Hebrew]{Simple CLM}
\newfontfamily\commentsfont[Mapping=tex-text]{Liberation Serif}
\setmonofont{UMTypewriter-Regular.otf}
  
\catcode"2318=13
\def⌘#1{%
%  \ensuremath{%
      \text{%
        \LR{%
         \bfseries
        \textcolor{olive!20!black}%
             {{#1}}%
        }% LR
      }%
%  }% Ensuremath
}%

\def\E|#1|{{\LR{#1}}}
\def\T|#1|{{\LR{\mini{#1}}}}

\def\ע|#1|{{\bfseries#1}}
\def\פנה|#1|{\cref{#1}}
\def\כיתוב|#1|{\caption{#1}}
\def\תגית|#1|{\label{#1}}
\def\דוגמה|#1|#2\par{\begin{example}[#1]#2\end{example}}

\crefname{definition}{הגדרה}{הגדרות}
\crefname{figure}{איור}{איורים}
\crefname{table}{טבלה}{טבלאות}
\crefname{section}{פרק}{פרקים}
\crefname{equation}{}{}
\crefformat{equation}{(#2#1#3)}

\renewcommand \contentsname{תוכן העניינים (מפורט)}
\renewcommand \listfigurename{רשימת האיורים}
\renewcommand \listtablename{רשימת הטבלאות}

\let\ref=\cref

\floatstyle{ruled}
\restylefloat{figure}
\def\UrlFont{\ttfamilylatin}

\graphicspath{{Images/}}

\def\maketag@@@#1{\hbox{\m@th\normalfont\LRE{#1}}}
\def\tagform@#1{\maketag@@@{(\ignorespaces#1\unskip)}}


\let\hebrewfonttt\ttfamily

% Roman Font: Uncomment precisely one option
%======================================================
%\setromanfont{Comic Sans MS}
%\setromanfont{David CLM}
%\setromanfont{Linux Libertine O}
%\setromanfont{David CLM}
%\setromanfont{Comic Sans MS}



% Liberation Serif

 % \let\hebrewfonttt\ttfamily
% Liberation Serif
%  \newfontfamily\hebrewfont[Script=Hebrew]{Times New Roman}
%  \newfontfamily\hebrewfont[Script=Hebrew]{Ezra SIL}
% \newfontfamily\hebrewfont[Script=Hebrew]{David CLM}

% Fix section numbering
\renewcommand\SepMark[1]{\def\@SepMark{#1}}\SepMark{.}

\newfontfamily \listingsfont[
            Extension=.otf,
						UprightFont=*-Regular,
						BoldFont=*-Bold,
						ItalicFont=*-Italic,
						BoldItalicFont=*-BoldItalic,
]{UMTypewriter}


\let\ttfamily=\listingsfont
\lstdefinestyle{bashfulStdout}{basicstyle=\sl\listingsfont\small,keywords={}}

\newenvironment{interaction}%
    {\parskip0pt\par\hrulefill\par}{\parskip0pt\par\hrulefill\par}

\lstdefinestyle{numbered}{
    backgroundcolor=\color{blue!20},
    style=display,
    numbers=right,
    stepnumber=1,
    numbersep=-6pt,
    xleftmargin=3ex,
    xrightmargin=3ex,
    numberblanklines=false,
    numberstyle=\tiny\bf,
    frame=trBL,
}

 
\newcommand\pfun{\mathrel{\ooalign{\hfil$\mapstochar\mkern5mu$\hfil\cr$\to$\cr}}}
\DeclareMathOperator\arity{arity}
\DeclareMathOperator\RE{Re}

\newenvironment{Output}{%
\setLTR
\quote
\vskip 1ex%
\qquad\qquad
\large\bfseries\itshape\underline{Output}%
}{\endquote\setRTL}

\usepackage{sukkar}

% Tune header
\pagestyle{fancy}
\fancyhead{}
\fancyhead[RO]{\slshape \rightmark}
\fancyhead[LE]{\slshape \leftmark}
\fancyfoot[C]{\thepage}
\headheight26pt

\newfloat{תכנית}{!htbp}{lop}[section]
\floatname{תכנית}{תכנית}

%\usepackage{unicode-math}

\catcode"2026=\active % …: U+2026 HORIZONTAL ELLIPSIS
\let…=\ldots
\lstdefinelanguage{Pascalx}{
  language=Pascal,
  morestring=[b]",
  deletekeywords={writeln,output,integer},
  morekeywords={[2]WriteLn,output,integer},
  keywordstyle={[2]\color{blue}\listingsfont\bfseries\itshape}}
\let\קד=\cd
\let\מש=\kw
\let\שי=\LR
\def\predefined#1{{\lstset{language=Pascalx}\lstinline!#1!}}
\let\מוגדרת␣מראש=\predefined

\newenvironment{קוד}{%
  \quote
  \minipage{\linewidth}%
  \setLTR
  }{%
  \endminipage
  \endquote
}

\renewcommand\floatpagefraction{.9}
\renewcommand\topfraction{.9}
\renewcommand\bottomfraction{.9}
\renewcommand\textfraction{.1}   
\setcounter{totalnumber}{50}
\setcounter{topnumber}{50}
\setcounter{bottomnumber}{50}

\input{00terms}


\let\עע=\cf


\parskip 0.75ex plus 0.25ex minus -0.25ex


\newcommand{\גיבור}[1] {
 \textbf{#1}}

\newcommand{\יניב}[1] {
 \Large{#1}
\normalsize{}}


\newcommand{\הכנס␣קוד}[3]{
\setLTR{}

\lstinputlisting[
language=#2,belowcaptionskip=1\baselineskip,
  breaklines=true,
  frame=single,frameround=tttt,
  xleftmargin=\parindent,
  showstringspaces=false,
  basicstyle=\footnotesize\ttfamily,
  keywordstyle=\bfseries\color{green!40!black},
  commentstyle=\itshape\color{purple!40!black},
  identifierstyle=\color{blue},
  stringstyle=\color{orange},
  backgroundcolor=\color{gray!10},
  columns=flexible,
  title={#3},
]{#1}

\setRTL{}
}


\newcommand{\הכנס␣קוד␣נקי}[2]{
\setLTR{}

\lstinputlisting[
language=#2,belowcaptionskip=1\baselineskip,
  breaklines=true,
  frame=single,frameround=tttt,
  xleftmargin=\parindent,
  showstringspaces=false,
  basicstyle=\footnotesize\ttfamily,
  keywordstyle=\bfseries\color{green!40!black},
  commentstyle=\itshape\color{purple!40!black},
  identifierstyle=\color{blue},
  stringstyle=\color{orange},
  backgroundcolor=\color{gray!10},
  columns=flexible,
]{#1}

\setRTL{}
}

\newenvironment{editing}[1]{%
  \eject
  \pagecolor{yellow!50}
  \large
  שימו לב, פרק זה בתהליכי שכתוב, אין לשלוח הערות בשלב זה
  \normalsize
}{
  \eject
  \pagecolor{white}
}


% Environment for writing syntax rules
\newenvironment{derivation}{\ignorespaces%
  \def\<##1>{\,⟨\text{\sffamily \scriptsize \slshape ##1}⟩\,}%
  \def\|{\meta{\mathbin{|}}}%
  \def\=##1={\,\text{\kk ##1}\,}%
  \def\meta##1{{\textcolor{red}{##1}}}%
  \def\({\meta{\left  (}}
  \def\){\meta{\right )}}
  \def\~##1~{\,\text{\inline!##1!}\,}%
  \def\"##1"{\,\text{\inline!##1!}\,}%
  \def\*{^{\meta*}}%
  \def\+{^{\meta+}}%
  \def\opt{\!_{\meta{opt}}\,}%
  \scriptsize%
}{\ignorespacesafterend}

\newtcolorbox{mybox}{colback=red!5!white,
colframe=red!75!black}

% Musn't have an empty new line before it
\newcommand{\הכרח␣שורה␣חדשה}{\\*\hfill\\}



\usetikzlibrary{calc}
\usetikzlibrary{trees,chains,shapes}
\usetikzlibrary{positioning,chains,arrows}
\forestset{%
  s tree/.style={
    for tree={
      circle,
      s sep'+=-3pt,
      fit=band,
    },
  },
  AST/.style={
      ellipse,
      fit=band,
      fill=blue!20,
  },
  nt/.style={circle,edge,fill=red!20},
  terminal/.style={rectangle, fill=gray!10,draw,minimum width=8ex},
  cons/.style={draw,edge,fill=teal},
  atom/.style={},
  nil/.style={circle,inner sep=-6pt,fill=white,nice empty nodes,tikz={\draw  [rotate=-160,scale=0.44] 
  \pgfsetlinewidth{6\pgflinewidth} % thickness
  ($(.center)!0.2!(!parent)$)
  coordinate (o)
  (o)++(-0.520,0) --++(1.04,0)
 % (o)++(-4,1) -- ++(8,0)
  (o)++(-0.380,.180) -- ++(.760,0)
 % (o)++(-2,3) --++(4,0)
  (o)++(-0.180,0.360) --++(0.360,0)
;}},
}  


\forestset{
nice empty nodes/.style={
    for tree={calign=fixed edge angles},
    delay={where content={}{shape=coordinate,for siblings={anchor=north}}{}}
}
}

